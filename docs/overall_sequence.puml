@startuml HammerspoonOverallSequence
title Hammerspoon hotkey binding (config-aware) and runtime feedback

actor User as user
participant "Hammerspoon engine" as engine
participant "init.lua" as init
participant "core/config_loader.lua" as configLoader
participant "core/init_system.lua" as initSystem
participant "modules.media_controls" as media
participant "modules.app_launcher" as launcher
participant "modules.keystroke_visualizer" as keyviz
participant "utils.hotkey_utils" as hotkeyUtils
participant "hs.hotkey" as hsHotkey
participant "utils.notification_utils" as notification
participant "hs.alert" as alert

autonumber

user -> engine: reload configuration
engine -> init: load init.lua
init -> configLoader: require("core.config_loader")
configLoader -> configLoader: load defaults + overrides
init -> initSystem: require("core.init_system")
initSystem -> initSystem: register module descriptors
initSystem -> media: init()
media -> hotkeyUtils: bind({ctrl,cmd,alt},"=", module="media_controls")
hotkeyUtils -> configLoader: get("hotkeys.announcements")
configLoader --> hotkeyUtils: module-level policy
hotkeyUtils -> hsHotkey: allocate binding (alerts per policy)
initSystem -> launcher: init()
launcher -> hotkeyUtils: bind("cmd+alt+C", module="app_launcher")
initSystem -> keyviz: init()
keyviz -> hotkeyUtils: bind("ctrl+cmd+alt+K", module="keystroke_visualizer")
initSystem --> init: modules ready
init --> engine: initialization complete

== runtime example ==
user -> hsHotkey: press ctrl+cmd+alt+up
hsHotkey -> media: invoke sendMediaKeyEvent()
media -> notification: sendAlert("Media: SOUND_UP", 0.5)
notification -> alert: hs.alert.show(...)
alert --> user: toast displayed (description only if module enabled)

note over hotkeyUtils
`module` option lets config-driven announcements decide
whether to forward descriptions to hs.hotkey.
All bindings still log via `hotkey_utils`.
end note

@enduml
